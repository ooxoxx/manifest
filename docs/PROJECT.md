# Manifest - AI 实验室资产管理系统

> **Product Requirements Document (PRD)**

| 属性 | 值 |
|------|-----|
| 文档版本 | 1.0.0 |
| 状态 | Draft |
| 创建日期 | 2024-01 |
| 最后更新 | 2024-01 |
| 产品负责人 | - |
| 技术负责人 | - |

---

## 1. 执行摘要

### 1.1 产品愿景

Manifest 是一个面向 AI 实验室的样本资产管理平台，旨在解决千万级 AI 训练样本的统一管理、高效检索和规范化运营问题。

### 1.2 核心价值主张

| 痛点 | 解决方案 | 价值 |
|------|---------|------|
| 样本分散在 MinIO、移动硬盘、本地磁盘 | 逻辑统一纳管，不移动原始数据 | 降低迁移成本，统一视图 |
| 千万级样本难以检索和分类 | 层级标签 + 正则批量打标 | 分钟级定位目标样本 |
| 数据集构建依赖人工筛选 | 智能筛选 + 自动配比 | 数据集构建效率提升 10x |
| 样本状态不透明 | 全生命周期追踪 | 样本可追溯、可审计 |
| 增量样本无法自动入库 | MinIO 事件订阅 | 实时同步，零人工干预 |

### 1.3 第一阶段目标（MVP）

构建样本管理核心能力，实现：
- 样本纳管与统一检索
- 层级标签分类体系
- 数据集筛选与构建
- 日常运营仪表板

### 1.4 成功指标

| 指标 | 目标值 | 衡量方式 |
|------|-------|---------|
| 样本纳管覆盖率 | ≥ 95% 现有样本 | 已纳管 / 总样本 |
| 样本检索耗时 | < 3 秒 | P95 响应时间 |
| 数据集构建效率 | 提升 10x | 对比人工筛选耗时 |
| 系统可用性 | ≥ 99.5% | 月度 Uptime |

---

## 2. 背景与问题陈述

### 2.1 业务背景

AI 实验室承担以下核心职责：
- 开展公司人工智能样本、模型业务运营
- 管理样本、模型等 AI 资产要素
- 开展样本归集、清洗、标注
- 开展各类模型的测试与评估

### 2.2 当前痛点

```
┌─────────────────────────────────────────────────────────────┐
│                      当前样本管理现状                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   MinIO 集群          移动硬盘           实验室 PC           │
│   ┌─────────┐        ┌─────────┐        ┌─────────┐        │
│   │ ~1000万 │        │  散落   │        │  散落   │        │
│   │  样本   │        │  样本   │        │  样本   │        │
│   └─────────┘        └─────────┘        └─────────┘        │
│        │                  │                  │              │
│        └──────────────────┼──────────────────┘              │
│                           ▼                                 │
│                    ❌ 无统一管理                             │
│                    ❌ 无法快速检索                           │
│                    ❌ 状态不可追踪                           │
│                    ❌ 数据集构建低效                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 目标状态

```
┌─────────────────────────────────────────────────────────────┐
│                      Manifest 目标架构                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   MinIO 集群          移动硬盘           实验室 PC           │
│   ┌─────────┐        ┌─────────┐        ┌─────────┐        │
│   │ ~1000万 │        │  散落   │        │  散落   │        │
│   │  样本   │        │  样本   │        │  样本   │        │
│   └────┬────┘        └────┬────┘        └────┬────┘        │
│        │ 事件订阅         │ 上传纳管         │ 上传纳管     │
│        └──────────────────┼──────────────────┘              │
│                           ▼                                 │
│              ┌─────────────────────────┐                    │
│              │      Manifest 平台      │                    │
│              │  ┌───────────────────┐  │                    │
│              │  │   逻辑索引层      │  │                    │
│              │  │  (元数据+标签)    │  │                    │
│              │  └───────────────────┘  │                    │
│              └─────────────────────────┘                    │
│                           │                                 │
│        ┌──────────────────┼──────────────────┐              │
│        ▼                  ▼                  ▼              │
│   ✅ 统一检索        ✅ 状态追踪        ✅ 智能筛选        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 用户与角色

### 3.1 目标用户

| 角色 | 职责 | 核心诉求 |
|------|------|---------|
| 数据工程师 | 样本入库、清洗、标签管理 | 高效批量操作，自动化处理 |
| 算法工程师 | 构建训练/测试数据集 | 快速筛选目标样本，查看模型表现 |
| 标注人员 | 样本标注 | 便捷查看待标注样本 |
| 项目经理 | 样本库运营监控 | 数据概览，趋势分析 |
| 系统管理员 | 系统配置、权限管理 | MinIO 实例管理，用户权限 |

### 3.2 用户权限矩阵

| 功能 | 管理员 | 数据工程师 | 算法工程师 | 标注人员 | 访客 |
|------|:------:|:----------:|:----------:|:--------:|:----:|
| MinIO 实例管理 | ✅ | ❌ | ❌ | ❌ | ❌ |
| 样本纳管 | ✅ | ✅ | ❌ | ❌ | ❌ |
| 标签体系管理 | ✅ | ✅ | ❌ | ❌ | ❌ |
| 批量打标签 | ✅ | ✅ | ✅ | ❌ | ❌ |
| 数据集构建 | ✅ | ✅ | ✅ | ❌ | ❌ |
| 样本查看 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 统计报表 | ✅ | ✅ | ✅ | ❌ | ❌ |

---

## 4. 功能需求

### 4.1 功能架构总览

```
┌─────────────────────────────────────────────────────────────────┐
│                        Manifest 功能架构                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  样本纳管   │  │  标签管理   │  │ 数据集构建  │             │
│  │             │  │             │  │             │             │
│  │ • 事件订阅  │  │ • 层级标签  │  │ • 智能筛选  │             │
│  │ • 存量导入  │  │ • 正则打标  │  │ • 逐张审核  │             │
│  │ • 上传入库  │  │ • 标签继承  │  │ • 自动配比  │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
│                                                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  状态追踪   │  │  统计分析   │  │  日常巡检   │             │
│  │             │  │             │  │             │             │
│  │ • 生命周期  │  │ • 多维统计  │  │ • 增量概览  │             │
│  │ • 操作历史  │  │ • 趋势分析  │  │ • 异常预警  │             │
│  │ • 数据集归属│  │ • 报表导出  │  │ • 快捷入口  │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 用户故事

#### US-1: 增量样本自动入库

**作为** 数据工程师
**我希望** 系统能自动跟踪 MinIO 中新增的样本
**以便** 无需人工干预即可保持样本库同步

**验收标准：**
- [ ] 可配置监听的 MinIO 桶和目录前缀
- [ ] 自动订阅 `s3:ObjectCreated:*` 和 `s3:ObjectRemoved:*` 事件
- [ ] 新文件上传后 < 30 秒内自动创建样本记录
- [ ] 文件删除后自动标记样本为已删除（保留历史）
- [ ] 提供事件处理日志和失败重试机制

---

#### US-2: 存量样本批量导入

**作为** 数据工程师
**我希望** 能批量导入历史样本清单
**以便** 快速将现有千万级样本纳入管理

**验收标准：**
- [ ] 支持 CSV/Excel 格式的样本清单导入
- [ ] 自动验证文件在 MinIO 中是否真实存在
- [ ] 生成验证报告（存在/缺失/不匹配）
- [ ] 验证通过的样本自动入库
- [ ] 支持断点续传和增量导入

---

#### US-3: 层级标签管理

**作为** 数据工程师
**我希望** 能创建和管理层级标签体系
**以便** 对样本进行多维度分类

**验收标准：**
- [ ] 支持创建多级标签树（如：输电/输电通道监拍/山火）
- [ ] 指定子标签时自动继承父级标签
- [ ] 支持标签的增删改查
- [ ] 支持标签合并和迁移
- [ ] 提供标签使用统计

---

#### US-4: 正则批量打标签

**作为** 数据工程师
**我希望** 能通过正则规则批量为样本打标签
**以便** 高效处理大量样本的分类

**验收标准：**
- [ ] 支持基于路径、文件名、日期的正则匹配
- [ ] 执行前可预览匹配结果
- [ ] 支持保存规则为模板复用
- [ ] 记录批量操作日志
- [ ] 支持回滚操作

---

#### US-5: 数据集智能筛选

**作为** 算法工程师
**我希望** 能按条件筛选样本构建数据集
**以便** 快速获取训练/测试所需的样本

**验收标准：**
- [ ] 支持按标签类别筛选
- [ ] 支持设定各类别数量配比
- [ ] 支持筛选模型误报/漏检样本
- [ ] 系统自动配比生成候选集
- [ ] 支持保存筛选条件为模板

---

#### US-6: 样本逐张审核

**作为** 算法工程师
**我希望** 能逐张审核候选样本
**以便** 精确控制最终数据集质量

**验收标准：**
- [ ] 提供样本预览（图像/内容）
- [ ] 展示样本标注信息
- [ ] 展示模型历史推理结果
- [ ] 支持保留/删除/跳过操作
- [ ] 支持键盘快捷键操作
- [ ] 支持批量操作

---

#### US-7: 样本状态追踪

**作为** 项目经理
**我希望** 能查看任意样本的完整生命周期
**以便** 了解样本的处理历史

**验收标准：**
- [ ] 记录样本入库、标注、筛选等所有操作
- [ ] 展示操作时间线
- [ ] 显示样本所属数据集
- [ ] 支持按操作类型筛选历史

---

#### US-8: 日常巡检仪表板

**作为** 项目经理
**我希望** 每天能快速了解样本库变化
**以便** 监控运营状态

**验收标准：**
- [ ] 展示昨日/今日新增样本数
- [ ] 按标签分类展示增量
- [ ] 展示未标注/已标注数量
- [ ] 支持时间范围切换
- [ ] 提供环比趋势对比
- [ ] 支持异常波动预警

---

## 5. 数据模型

### 5.1 核心实体关系

```
┌──────────────┐       ┌──────────────┐       ┌──────────────┐
│ MinIOInstance│       │    Sample    │       │     Tag      │
├──────────────┤       ├──────────────┤       ├──────────────┤
│ id           │◄──┐   │ id           │   ┌──►│ id           │
│ name         │   │   │ name         │   │   │ name         │
│ endpoint     │   │   │ type         │   │   │ full_path    │
│ access_key   │   └───│ minio_inst_id│   │   │ parent_id    │
│ secret_key   │       │ bucket       │   │   │ level        │
└──────────────┘       │ object_key   │   │   └──────────────┘
                       │ file_hash    │   │
┌──────────────┐       │ ...          │   │   ┌──────────────┐
│  Annotation  │       └──────┬───────┘   │   │  SampleTag   │
├──────────────┤              │           │   ├──────────────┤
│ id           │◄─────────────┤           └───│ sample_id    │
│ sample_id    │              │               │ tag_id       │
│ type         │              │               │ source       │
│ content      │              ▼               └──────────────┘
└──────────────┘       ┌──────────────┐
                       │SampleHistory │       ┌──────────────┐
┌──────────────┐       ├──────────────┤       │   Dataset    │
│    Model     │       │ sample_id    │       ├──────────────┤
├──────────────┤       │ action       │       │ id           │
│ id           │       │ operator_id  │       │ name         │
│ name         │       │ created_at   │       │ status       │
│ version      │       └──────────────┘       │ sample_count │
└──────┬───────┘                              └──────────────┘
       │
       ▼
┌──────────────┐
│InferRecord   │
├──────────────┤
│ sample_id    │
│ model_id     │
│ result       │
│ error_type   │
└──────────────┘
```

### 5.2 实体详细定义

#### Sample（样本）

| 字段 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| id | UUID | ✅ | 主键 |
| name | String | ✅ | 文件名 |
| type | Enum | ✅ | 图像/多模态/文本/文档 |
| minio_instance_id | UUID | ✅ | 关联 MinIO 实例 |
| bucket | String | ✅ | 桶名 |
| object_key | String | ✅ | 对象路径 |
| file_size | Integer | ✅ | 文件大小(bytes) |
| file_hash | String | ✅ | SHA256 哈希 |
| mime_type | String | ✅ | MIME 类型 |
| source_path | String | - | 原始来源路径 |
| ingestion_type | Enum | ✅ | 事件订阅/批量导入/上传 |
| is_deleted | Boolean | ✅ | 软删除标记 |
| created_at | DateTime | ✅ | 入库时间 |
| updated_at | DateTime | ✅ | 更新时间 |

#### Tag（层级标签）

| 字段 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| id | UUID | ✅ | 主键 |
| name | String | ✅ | 标签名称 |
| full_path | String | ✅ | 完整路径（/分隔） |
| parent_id | UUID | - | 父标签ID |
| level | Integer | ✅ | 层级深度 |
| description | String | - | 描述 |
| sample_count | Integer | ✅ | 关联样本数（缓存） |

#### WatchedPath（纳管路径）

| 字段 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| id | UUID | ✅ | 主键 |
| minio_instance_id | UUID | ✅ | MinIO 实例 |
| bucket | String | ✅ | 桶名 |
| prefix | String | - | 目录前缀 |
| event_arn | String | - | 事件订阅 ARN |
| status | Enum | ✅ | 启用/暂停/错误 |
| last_sync_at | DateTime | - | 最后同步时间 |

---

## 6. 非功能性需求

### 6.1 性能要求

| 场景 | 指标 | 目标值 |
|------|------|-------|
| 样本列表加载 | P95 响应时间 | < 500ms |
| 样本搜索 | P95 响应时间 | < 3s |
| 批量导入 | 吞吐量 | ≥ 1000 条/秒 |
| 事件处理 | 延迟 | < 30s |
| 并发用户 | 支持数 | ≥ 50 |

### 6.2 可用性要求

- 系统可用性：≥ 99.5%（月度）
- 计划内维护窗口：每月 ≤ 4 小时
- 故障恢复时间（RTO）：< 4 小时
- 数据恢复点（RPO）：< 1 小时

### 6.3 安全要求

- 用户认证：JWT Token，支持过期刷新
- 权限控制：基于角色的访问控制（RBAC）
- 数据传输：HTTPS 加密
- 敏感信息：MinIO 密钥加密存储
- 审计日志：记录所有敏感操作

### 6.4 兼容性要求

- 浏览器：Chrome 90+、Firefox 88+、Edge 90+
- MinIO：兼容 S3 API 的对象存储
- 样本格式：JPEG、PNG、PDF、TXT、JSON 等

---

## 7. 技术架构

### 7.1 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                           客户端                                 │
│                    React + TypeScript                           │
└─────────────────────────────┬───────────────────────────────────┘
                              │ HTTPS
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Traefik 反向代理                          │
└─────────────────────────────┬───────────────────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│   FastAPI 后端  │ │   静态资源      │ │   MinIO Console │
│   (业务逻辑)    │ │   (前端构建)    │ │   (可选)        │
└────────┬────────┘ └─────────────────┘ └─────────────────┘
         │
    ┌────┴────┬─────────────┐
    ▼         ▼             ▼
┌────────┐ ┌────────┐ ┌──────────┐
│PostgreSQL│ │ Redis │ │  MinIO   │
│ (元数据) │ │(缓存) │ │(样本存储)│
└────────┘ └────────┘ └──────────┘
```

### 7.2 技术栈

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 前端框架 | React 19 + TypeScript | 类型安全，生态丰富 |
| 构建工具 | Vite | 快速开发体验 |
| UI 组件 | Tailwind CSS + shadcn/ui | 现代化设计系统 |
| 状态管理 | TanStack Query | 服务端状态管理 |
| 后端框架 | FastAPI | 高性能，自动文档 |
| ORM | SQLModel | SQLAlchemy + Pydantic |
| 数据库 | PostgreSQL | 可靠，支持 JSON |
| 缓存 | Redis | 高性能缓存 |
| 对象存储 | MinIO | S3 兼容 |
| 消息队列 | Redis Streams | 事件处理 |
| 容器化 | Docker Compose | 简化部署 |
| 反向代理 | Traefik | 自动 HTTPS |

---

## 8. 风险与依赖

### 8.1 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| 千万级样本查询性能 | 高 | 中 | 数据库索引优化，分页加载，缓存 |
| MinIO 事件丢失 | 高 | 低 | 消息队列持久化，定期全量同步 |
| 批量导入内存溢出 | 中 | 中 | 流式处理，分批导入 |

### 8.2 外部依赖

| 依赖 | 类型 | 风险等级 |
|------|------|---------|
| MinIO 集群 | 基础设施 | 高 |
| PostgreSQL | 基础设施 | 高 |
| 现有样本清单 | 数据 | 中 |

---

## 9. 开发环境

### 9.1 快速启动

```bash
# 启动服务
docker compose watch

# 查看日志
docker compose logs -f backend
```

### 9.2 访问地址

| 服务 | 地址 |
|------|------|
| 前端 | http://127.0.0.1:5173 |
| 后端 API | http://127.0.0.1:8000 |
| API 文档 | http://127.0.0.1:8000/docs |
| 数据库管理 | http://127.0.0.1:8080 |

---

## 10. 附录

### 10.1 术语表

| 术语 | 定义 |
|------|------|
| 样本 (Sample) | AI 训练/测试使用的数据单元 |
| 纳管 | 将样本纳入系统管理 |
| 标签 (Tag) | 样本的分类标记 |
| 数据集 (Dataset) | 样本的逻辑集合 |
| 推理记录 | 模型在样本上的预测结果 |

### 10.2 文档版本历史

| 版本 | 日期 | 变更说明 | 作者 |
|------|------|---------|------|
| 1.0.0 | 2024-01 | 初始版本 | - |