# Manifest 前端 UX 重设计方案

> **版本**: 1.0.0
> **日期**: 2026-01-19
> **状态**: 已确认

---

## 1. 设计目标

基于 MVP 设计文档和 PRD 的用户场景，解决当前界面的两个核心问题：

1. **导航效率低** — 用户需要频繁在不同页面间跳转才能完成一个工作流
2. **工作流断裂** — 核心任务分散在不同入口，用户不知道下一步该做什么

### 核心设计理念

- **按任务流组织导航** — 用户思考"我要做什么"而非"我要看什么资源"
- **工作台 + 配置分区** — 高频任务与低频配置分离
- **浏览可启动任务流** — 选中样本后直接进入构建向导，上下文无缝衔接

---

## 2. 导航结构

### 整体布局

侧边栏分为两个视觉区块：

```
工作台（主区域）
├── 样本入库        → 单页向导：导入 CSV、验证、打标签
├── 数据集构建      → 单页向导：筛选、配比、审核、确认
├── 运维中心        → 监测仪表板：统计、趋势、系统状态
├── 样本浏览        → 列表页，可启动任务流
└── 数据集浏览      → 列表页，可进入审核

配置（次要区域，视觉上与工作台分隔）
├── 标签管理
├── MinIO 实例
└── 用户管理        → 仅管理员可见
```

### 导航交互

- 任务流入口（入库、构建）点击后进入单页向导，侧边栏保持可见
- 浏览入口点击后保持侧边栏可见，标准列表布局
- 运维中心是仪表板，保持侧边栏可见
- 浏览页可启动任务流：选中样本后可点击"添加到数据集"进入构建向导

---

## 3. 样本入库向导

### 整体布局

```
┌─────────┬───────────────────────────────────────────────────────┐
│ 侧边栏   │  样本入库                              步骤 2/4      │
│         ├───────────────────────────────────────────────────────┤
│ 工作台   │                                                      │
│ ├ 样本入库←│   ┌────────────┐    ┌──────────────────────────┐   │
│ ├ 数据集构建│   │ 步骤导航    │    │   当前步骤内容           │   │
│ ├ 运维中心 │   │            │    │                          │   │
│ ├ 样本浏览 │   │ ✓ 1. 上传   │    │   [验证结果...]          │   │
│ └ 数据集浏览│   │ ● 2. 验证 ← │    │                          │   │
│         │   │ ○ 3. 标签   │    │                          │   │
│ 配置     │   │ ○ 4. 确认   │    │                          │   │
│ ├ 标签管理 │   └────────────┘    └──────────────────────────┘   │
│ └ MinIO  │                                                      │
└─────────┴───────────────────────────────────────────────────────┘
```

### 四个步骤

| 步骤 | 内容 | 用户操作 |
|------|------|---------|
| 1. 上传 CSV | 选择 MinIO 实例、桶，上传 CSV 文件 | 拖拽上传或选择文件 |
| 2. 验证文件 | 显示验证进度和结果（存在/缺失/重复统计） | 查看报告，决定是否继续 |
| 3. 关联标签 | 为本批样本指定标签，或按 CSV 列自动解析 | 选择/创建标签 |
| 4. 确认入库 | 汇总预览，显示将创建的样本数和关联的标注 | 点击"开始入库" |

### 状态保持

- 每个步骤完成后状态自动保存到 URL query 参数
- 用户可点击已完成步骤回退修改
- 关闭页面后再进入，显示"继续上次任务"提示

---

## 4. 数据集构建向导

### 步骤设计

| 步骤 | 内容 | 说明 |
|------|------|------|
| 1. 基本信息 | 数据集名称、描述 | 简单表单 |
| 2. 筛选条件 | 标签、时间、路径、标注类别、目标数量等 | 复用 FilterPanel |
| 3. 采样配比 | 随机采样比例 或 按类别目标框数量配比 | 显示预估匹配数 |
| 4. 预览审核 | 候选样本列表，支持逐张审核模式切换 | 保留/移除/跳过 |
| 5. 确认生成 | 汇总统计，确认创建数据集 | 显示最终样本数 |

### 预览审核步骤的双模式

在第 4 步，用户可以在两种模式间切换：

**列表模式**（默认）
- 表格展示候选样本，带缩略图、标注状态、类别标签
- 支持批量勾选移除
- 快速浏览大量样本

**逐张模式**
- 单张大图 + bbox 叠加显示
- 键盘快捷键：Y 保留 / N 移除 / S 跳过 / ←→ 切换
- 显示当前进度（第 23/156 张）

两种模式操作的是同一份候选列表，切换时状态同步。

---

## 5. 运维中心

### 整体定位

运维中心是**样本库健康监测仪表板**，帮助用户了解：
- 样本库的整体规模和变化趋势
- 存储和标注的状态分布
- 系统运行状况

### 布局结构

```
┌─────────────────────────────────────────────────────────────────┐
│  运维中心                                    时间范围: [本周 ▼]  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌───────────┐ │
│  │ 样本总量     │ │ 已标注      │ │ 本周新增    │ │ 存储实例   │ │
│  │ 1,234,567   │ │ 892,340     │ │ +12,450    │ │ 3 个在线   │ │
│  │             │ │ (72.3%)     │ │ ↑15%       │ │            │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └───────────┘ │
│                                                                 │
│  ┌────────────────────────────────┐ ┌─────────────────────────┐ │
│  │ 样本增长趋势                    │ │ 标签分布 Top 10         │ │
│  │                                │ │                         │ │
│  │  ▁▂▃▄▅▆▇█  (折线图)           │ │  输电/山火    45,230    │ │
│  │                                │ │  输电/通道    38,120    │ │
│  │  近30天每日新增样本数           │ │  配电/...     21,500    │ │
│  └────────────────────────────────┘ └─────────────────────────┘ │
│                                                                 │
│  ┌────────────────────────────────┐ ┌─────────────────────────┐ │
│  │ 标注状态分布                    │ │ 系统状态                │ │
│  │                                │ │                         │ │
│  │  ● 已标注 72%                  │ │  导入任务: 1 进行中     │ │
│  │  ● 无标注 25%                  │ │  标注冲突: 3 待处理     │ │
│  │  ● 冲突   3%  [查看详情]       │ │  最近同步: 5分钟前      │ │
│  └────────────────────────────────┘ └─────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 交互说明

- **时间范围选择器**：切换查看 今日 / 本周 / 本月 / 自定义
- **标注冲突"查看详情"**：跳转到冲突处理页面（可作为运维中心的子页面）
- **导入任务状态**：点击可展开查看任务列表和进度
- **各统计卡片**：点击可跳转到对应的样本浏览页（带预设筛选条件）

---

## 6. 样本浏览

### 双模式设计

**列表模式**（默认）

```
┌─────────────────────────────────────────────────────────────────┐
│  样本浏览                                                       │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 筛选条件栏（可折叠）                                         ││
│  │ 标签: [输电 ▼]  时间: [全部 ▼]  标注状态: [全部 ▼]  [更多筛选]││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                 │
│  已选中 3 项  [添加到数据集] [批量打标签] [清除选择]              │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ ☑ │ 缩略图 │ 文件名          │ 标注 │ 类别      │ 入库时间  ││
│  │───│───────│────────────────│─────│──────────│──────────││
│  │ ☑ │ [img] │ sample001.jpg  │ ✓   │ person,car│ 2026-01-15││
│  │ ☑ │ [img] │ sample002.jpg  │ ✓   │ person    │ 2026-01-15││
│  │ ☐ │ [img] │ sample003.jpg  │ -   │ -         │ 2026-01-14││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                 │
│  显示 1-50 / 共 12,450 条                    [< 1 2 3 ... 249 >]│
└─────────────────────────────────────────────────────────────────┘
```

**逐张模式**

```
┌─────────────────────────────────────────────────────────────────┐
│  样本浏览                    [列表模式] [逐张模式 ●]             │
│  当前筛选: 标签=输电/山火, 标注状态=已标注          共 2,450 张  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│         ┌───────────────────────────────────────────┐           │
│         │                                           │           │
│   [←]   │        图像 + bbox 叠加显示               │    [→]    │
│         │                                           │           │
│         │                                           │           │
│         └───────────────────────────────────────────┘           │
│                                                                 │
│         第 127 / 2,450 张                    [跳转: ___]        │
│                                                                 │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │ 文件: images/2024/01/sample127.jpg                         │ │
│  │ 标注: person(3), car(2)     标签: 输电, 山火                │ │
│  │ 入库时间: 2026-01-15        大小: 1920x1080                 │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  快捷键: ← → 翻页 | ESC 返回列表                                │
└─────────────────────────────────────────────────────────────────┘
```

### 交互要点

- 点击行：切换到逐张模式，从该样本开始
- 勾选后：顶部出现批量操作栏
- "添加到数据集"：弹出选择器（选择已有数据集 或 启动构建向导）
- 筛选条件与数据集构建中的 FilterPanel 复用同一组件
- 逐张模式保持当前筛选条件，只浏览符合条件的样本
- 支持键盘 ←→ 翻页，ESC 返回列表模式

---

## 7. 数据集浏览

```
┌─────────────────────────────────────────────────────────────────┐
│  数据集浏览                                        [新建数据集]  │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 名称              │ 样本数   │ 创建时间   │ 操作            ││
│  │───────────────────│─────────│───────────│────────────────││
│  │ 山火检测训练集 v2  │ 5,230   │ 2026-01-18│ [查看] [审核]   ││
│  │ 通道监拍测试集     │ 1,200   │ 2026-01-15│ [查看] [审核]   ││
│  │ 配电设备验证集     │ 890     │ 2026-01-10│ [查看] [审核]   ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
```

### 交互要点

- "查看"：展开该数据集的样本列表（类似样本浏览，但范围限定在该数据集）
- "审核"：进入逐张审核模式，可继续对数据集内样本进行保留/移除操作
- "新建数据集"：跳转到数据集构建向导

---

## 8. 配置区域

### 标签管理

```
┌─────────────────────────────────────────────────────────────────┐
│  标签管理                                          [新建标签]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────┐  ┌───────────────────────────────┐ │
│  │ 标签树（左侧）           │  │ 标签详情（右侧）              │ │
│  │                         │  │                               │ │
│  │  ▼ 输电                 │  │ 输电/山火                     │ │
│  │    ├─ 山火 ←选中        │  │                               │ │
│  │    ├─ 通道监拍          │  │ 关联样本: 45,230              │ │
│  │    └─ 设备巡检          │  │ 子标签数: 0                   │ │
│  │  ▶ 配电                 │  │ 创建时间: 2026-01-10          │ │
│  │  ▶ 变电                 │  │                               │ │
│  │                         │  │ [编辑] [删除]                 │ │
│  └─────────────────────────┘  └───────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### MinIO 实例

```
┌─────────────────────────────────────────────────────────────────┐
│  MinIO 实例                                       [添加实例]    │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 名称        │ Endpoint          │ 状态   │ 样本数  │ 操作   ││
│  │─────────────│──────────────────│───────│────────│───────││
│  │ 生产存储     │ minio.prod:9000  │ 🟢 在线│ 892,340│ [编辑] ││
│  │ 测试存储     │ minio.test:9000  │ 🟢 在线│ 12,450 │ [编辑] ││
│  │ 备份存储     │ minio.bak:9000   │ 🔴 离线│ 0      │ [编辑] ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
```

### 用户管理（仅管理员）

保持现有设计，表格列出用户，支持新增/编辑/删除。

---

## 9. 与现有实现的主要变化

| 现有 | 新设计 |
|------|-------|
| 导航: 样本/标签/数据集/MinIO | 导航: 工作台（任务流+浏览） / 配置 |
| Dashboard 展示统计卡片 | 运维中心：趋势图 + 状态监测 |
| 数据集构建是独立页面 | 数据集构建是 5 步单页向导 |
| 样本只有列表模式 | 样本支持列表 + 逐张双模式 |
| CSV 导入是独立页面 | 样本入库是 4 步单页向导 |

---

## 10. 路由设计

```
/                           → 重定向到 /ops（运维中心）

# 工作台 - 任务流
/import                     → 样本入库向导
/build                      → 数据集构建向导

# 工作台 - 浏览
/ops                        → 运维中心（仪表板）
/samples                    → 样本浏览（列表模式）
/samples/:id                → 样本浏览（逐张模式，从指定样本开始）
/datasets                   → 数据集浏览
/datasets/:id               → 数据集详情/样本列表
/datasets/:id/review        → 数据集审核模式

# 配置
/settings/tags              → 标签管理
/settings/minio             → MinIO 实例
/settings/users             → 用户管理（管理员）
/settings/profile           → 个人设置
```

---

## 11. 核心设计决策

| 决策 | 说明 |
|------|------|
| 按任务流组织导航 | 用户思考"我要做什么"而非"我要看什么资源" |
| 工作台 + 配置分区 | 高频任务与低频配置分离 |
| 单页向导 | 步骤间自由跳转，状态实时保存 |
| 浏览可启动任务流 | 选中样本后直接进入构建向导，上下文无缝衔接 |
| 列表/逐张双模式 | 批量浏览与精细查看兼顾 |
| 运维中心是监测仪表板 | 观察趋势和状态，而非待办清单 |
